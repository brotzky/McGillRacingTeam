$(document).ready(function(){function e(){$(".aside-default").addClass("aside-active"),$(".hideLoading").fadeOut(333)}function t(e){var t=0;for(var o in e)for(var a in e[o])++t;return t/e.length}function o(e){var t=[];for(prop in e)for(secondProp in e[prop])t.push(e[prop][secondProp]);return t}function a(e){function a(e){e.chart.chartCursor.addListener("changed",r),e.chart.chartCursor.addListener("onHideCursor",i)}function n(e){for(S in C)C[S].ignoreZoom&&(C[S].ignoreZoom=!1),e.chart!=C[S]&&(C[S].ignoreZoom=!0,C[S].zoomToDates(e.startDate,e.endDate))}function r(e){for(var t in C)e.chart!=C[t]&&e.position&&(C[t].chartCursor.isZooming(e.target.zooming),C[t].chartCursor.selectionPosX=e.target.selectionPosX,C[t].chartCursor.forceShow=!0,C[t].chartCursor.setPosition(e.position,!1,e.target.index))}function i(){for(var e in C)C[e].chartCursor.hideCursor&&(C[e].chartCursor.forceShow=!1,C[e].chartCursor.hideCursor(!1))}var s=t(e),l=o(e),d=[];for(nextProp in e)d.push(Object.keys(e[nextProp]));for(var c=[],u=0;2*s>u;u++)c[u]=[];for(var u=0;u<l.length;u+=s)for(var p=1;p<2*d.length-1;p++){var m={},f=(l[u].toHHMMSS(),d[0][p]);if(m[f]=l[u+p],m[d[0][0]]=l[u].toHHMMSS(),!c[p-1])break;c[p-1].push(m)}for(var h=["#ed5153","#323a45","#3F51B5","#009688","#BF360C","#4CAF50","#FF9800","#FF5722","#607D8B","#673AB7","#D32F2F","#880E4F","#283593","#004D40","#01579B","#4CAF50","#FBC02D","#424242","#3F51B5","#7CB342","#00BCD4","#455A64","#1565C0","#4CAF50","#990000","#283593","#FF5722","#607D8B","#673AB7","#D32F2F","#880E4F","#283593","#ed5153","#323a45","#3F51B5","#009688","#BF360C","#4CAF50","#FF9800","#FF5722","#607D8B","#673AB7","#D32F2F","#880E4F","#283593","#004D40","#01579B","#4CAF50","#FBC02D","#424242","#3F51B5"],v=document.getElementById("sideList"),g=[],u=0;u<d[0].length-1;u++)g[u]=[];var C=[];for(u=0;u<d[0].length-1;u++){var F=document.createElement("div"),y=document.createElement("li"),L=document.createElement("a"),M=document.createElement("h2"),B=document.createElement("span");$("#amchartContainer").length||(F.id="amchartContainer",document.getElementsByTagName("body")[0].appendChild(F)),B.id=d[0][u+1],F=document.getElementById("amchartContainer"),M.innerHTML=d[0][u+1],temp=document.createElement("div"),temp.id="chartdiv"+[u],L.href="#"+d[0][u+1],L.innerHTML=d[0][u+1],y.appendChild(L),y.innerHTML="<a href='#"+d[0][u+1]+"'>"+d[0][u+1]+" </a>",F.appendChild(M),F.appendChild(temp),v.appendChild(y),M.appendChild(B);var b=temp.id.toString();g[u]={type:"serial",theme:"dark",dataDateFormat:"HH:NN:SS",marginRight:50,autoMarginOffset:50,dataProvider:c[u],responsive:{enabled:!0},balloon:{cornerRadius:0},valueAxes:[{axisAlpha:0}],graphs:[{balloonText:"[[lapTimeOfDay]]<br><b><span style='font-size:14px;'>[[value]]</span></b>",bullet:"round",bulletSize:6,connect:!1,gapPeriod:200,lineColor:h[u],lineThickness:1,negativeLineColor:"#487dac",valueField:d[0][u+1].toString()}],chartCursor:{categoryBalloonDateFormat:"HH:NN:SS",cursorAlpha:.1,cursorColor:h[u],fullWidth:!0,graphBulletSize:2},chartScrollbar:{},categoryField:"lapTimeOfDay",categoryAxis:{minPeriod:"ss",parseDates:!0,minorGridEnabled:!0},"export":{enabled:!0}},C.push(AmCharts.makeChart(b,g[u]))}for(var S in C)C[S].addListener("zoomed",n),C[S].addListener("init",a)}function n(){$(".moreInfo").toggleClass("showMoreInfo"),"More"===$(this).text()?(f.innerHTML="Less",f.style.paddingLeft="19px"):(f.innerHTML="More",f.style.paddingLeft="16px")}function r(){var e=new Firebase("//torrid-fire-7257.firebaseio.com/"+l());e.on("value",function(e){snapshotObj=e.val();for(var t=o(snapshotObj),a=[],n=0;n<t.length;n++)a[n]=document.createElement("li");for(var r=(document.getElementById("commentList"),$("#commentList")),n=0;n<t.length;n++)a[n]="<li>"+t[n]+"</li>",r.append(a[n])},function(e){console.log("The read failed: "+e.code)})}function i(){var e=$("#commentList");e.children().length>1&&($("#amchartContainer").fadeOut(300),e.children().remove())}function s(){return $(".selectInput").val()}function l(){return s().substr(s().lastIndexOf("/")+1).split(".").shift()}function d(){c.unauth();var e=c.getAuth();e||(window.location="/mrt/")}var c=new Firebase("//torrid-fire-7257.firebaseio.com"),u=$(".uploadMessage"),p=$(".toBeUploaded"),m=$(".aside-comments");!function(){document.getElementById("topNav").className+="onload-reveal";var t=$(".selectInput > option:first-child").val();$(".hideLoading").show(),-1===t.indexOf("csv")?$.getJSON(t,function(t){a(t),r(),e()}):Papa.parse(t,{download:!0,header:!0,skipEmptyLines:!0,complete:function(t){console.log(t.data),a(t.data),r(),e()}})}(),$(".selectInput").change(function(){var t=$("#amchartContainer");$(".hideLoading").show(),$("aside").removeClass("aside-active"),t.children().length>1&&(t.fadeOut(300),setTimeout(function(){t.remove(),$("#sideList").children().remove()},300)),i();var o=s();setTimeout(function(){-1===o.indexOf("csv")?$.getJSON(o,function(t){a(t),r(),e()}):Papa.parse(o,{download:!0,header:!0,skipEmptyLines:!0,complete:function(t){console.log(t.data),a(t.data),r(),e()}})},525)}),String.prototype.toHHMMSS=function(){var e=parseInt(this,10),t=Math.floor(e/3600),o=Math.floor((e-3600*t)/60),a=e-3600*t-60*o;10>t&&(t="0"+t),10>o&&(o="0"+o),10>a&&(a="0"+a);var n=t+":"+o+":"+a;return n};var f=document.querySelector(".moreButton");f.addEventListener("click",n,!1),$(".postComments").submit(function(e){e.preventDefault();var t=$(".addComment").val(),o=$("#commentList");o.children().length>1&&o.children().remove();var a=c.child(l());a.push({comment:t})}),$(".toggleComments").click(function(){m.toggleClass("aside-active")}),$(document).keyup(function(e){if(27===e.keyCode){var t=$(".moreInfo"),o=document.querySelector(".moreButton");"More"===$(".moreButton").text()&&t.hasClass("showMoreInfo")?(o.innerHTML="Less",o.style.paddingLeft="19px"):(o.innerHTML="More",o.style.paddingLeft="16px"),m.removeClass("aside-active"),t.removeClass("showMoreInfo")}}),$(document).scrollScope();var h=document.querySelector(".logoutButton");h.addEventListener("click",d,!1),$("#fileToUpload").change(function(){p.val().length>30?($(".uploadMessage > p").text("Sorry, file name must be less than 30 characeters"),u.addClass("uploadMessage-active").delay(5e3).queue(function(e){$(this).removeClass("uploadMessage-active"),e()})):(p.val($(this).val().split("\\").pop()),$(".confirmUpload").addClass("confirmUpload-active"))}),$(".uploadForm").submit(function(e){e.preventDefault();var t="/mrt/csvUploader.php",o=new FormData(this),a=$("#fileToUpload").val();fileExt=-1===a.indexOf("json")?".csv":".json";var n=a.split("\\").pop().split(".").shift();return $(".confirmUpload").removeClass("confirmUpload-active"),u.css("background-color","#D32F2F"),$.ajax({type:"POST",url:t,data:o,processData:!1,contentType:!1,success:function(e){if($(".uploadMessage > p").text(e),u.addClass("uploadMessage-active").delay(4800).queue(function(e){$(this).removeClass("uploadMessage-active"),e()}),e.indexOf("succesfully")>-1){$(".uploadMessage").css("background-color","#388E3C");var t=document.createElement("option");fileNameReplaced=n.replace(/_/g," "),t.innerHTML=fileNameReplaced,t.value="/mrt/inputdata/"+n+fileExt,$(".selectInput").prepend(t)}}}),!1})});